{% extends "layouts/spotify.html" %}

{% block panel_title %}
Playlists
<div style="float: right;">
  <label for="shuffle-checkbox" class="btn btn-xs">
    {% if user.PlaybackMode == 'SHUFFLE' %}
    <input type="checkbox" checked="checked" id="shuffle-checkbox" />
    {% else %}
    <input type="checkbox" id="shuffle-checkbox" />
    {% endif %}
    Shuffle
  </label>
  {% if selected_playlist_uri %}
  <button class="btn btn-xs btn-deselect-playlists">Clear Selection</button>
  {% else %}
  <button class="btn btn-xs btn-deselect-playlists" disabled="disabled">Clear Selection</button>
  {% endif %}
</div>
{% endblock %}

{% block panel_body %}
{% for playlist in playlists %}
<strong>
  {% if selected_playlist_uri == playlist.spotifyPlaylist.uri %}
  <button class="btn btn-xs btn-select-playlist playlist-selected btn-success" data-uri="{{ playlist.spotifyPlaylist.uri }}" disabled="disabled">Selected</button>
  {% else %}
  <button class="btn btn-xs btn-select-playlist" data-uri="{{ playlist.spotifyPlaylist.uri }}">Select</button>
  {% endif %}
  <a href="{{ playlist.spotifyPlaylist.external_urls.spotify }}">{{ playlist.spotifyPlaylist.name }}</a>
</strong><br />
(id: {{ playlist.spotifyPlaylist.uri }})<br />
<br />
{% endfor %}
{% endblock %}

{% block scripts %}
<script type="text/javascript">
  $(function() {
    $(".btn-deselect-playlists").click(function() {
      var btn = $(this);
      $.post("/me/playback", {
        playlist_uri: null
      }, function() {
        $(".btn-select-playlist.playlist-selected")
          .removeAttr("disabled")
          .removeClass("playlist-selected")
          .removeClass("btn-success")
          .text("Select");
        btn.attr("disabled", "disabled");
      });
    });

    $(".btn-select-playlist").click(function() {
      var btn = $(this);
      $.post("/me/playback", {
        playlist_uri: $(this).data("uri")
      }, function() {
        $(".btn-select-playlist.playlist-selected")
          .removeAttr("disabled")
          .removeClass("playlist-selected")
          .removeClass("btn-success")
          .text("Select");
        btn
          .attr("disabled", "disabled")
          .addClass("playlist-selected")
          .addClass("btn-success")
          .text("Selected");
        $(".btn-deselect-playlists")
          .removeAttr("disabled");
      });
    });

    $("#shuffle-checkbox").change(function() {
      var cb = $(this);
      var label = $(this).parent();

      cb.attr("disabled", "disabled");
      label.addClass("disabled");

      $.post("/me/playback", {
        shuffle: cb.is(":checked")
      }, function() {
        cb.removeAttr("disabled");
        label.removeClass("disabled");
      });
    });
  });
</script>
{% endblock %}

